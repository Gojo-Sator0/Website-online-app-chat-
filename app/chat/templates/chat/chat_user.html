{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid chat-container">
    <div class="row flex-nowrap">
        <!-- Боковая панель выбора чатов -->
        <div class="col-md-3 chat-sidebar p-0 bg-white border-end">
            <!-- Заголовок и поиск -->
            <div class="p-3 border-bottom">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="d-flex align-items-center gap-3">
                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <h5 class="mb-0">Chats</h5>
                    </div>
                    <i class="fas fa-cog text-muted"></i>
                </div>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" placeholder="Search">
                </div>
            </div>

            <!-- Список чатов -->
            <div class="overflow-y-auto" style="height: calc(100vh - 145px);">
                <!-- Элемент чата -->
                <a href="" class="text-decoration-none text-dark">
                    <div class="d-flex align-items-center p-3 border-bottom hover-bg-light">
                        <div class="position-relative me-3">
                            <img src="{% static 'images/profile-icon.png' %}" alt="User 1" class="rounded-circle" style="width: 50px; height: 50px;">
                            <div class="online-dot"></div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0">User 1</h6>
                            <p class="text-muted small mb-0">Hey, how are you?</p>
                        </div>
                        <span class="text-muted small">10:06 AM</span>
                    </div>
                </a>

                <!-- Элемент чата -->
                <a href="" class="text-decoration-none text-dark">
                    <div class="d-flex align-items-center p-3 border-bottom hover-bg-light">
                        <div class="position-relative me-3">
                            <img src="{% static 'images/profile-icon.png' %}" alt="User 2" class="rounded-circle" style="width: 50px; height: 50px;">
                            <div class="online-dot"></div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0">User 2</h6>
                            <p class="text-muted small mb-0">Good morning!</p>
                        </div>
                        <span class="text-muted small">9:45 AM</span>
                    </div>
                </a>
                <!-- Элемент чата -->
                <a href="" class="text-decoration-none text-dark">
                    <div class="d-flex align-items-center p-3 border-bottom hover-bg-light">
                        <div class="position-relative me-3">
                            <img src="{% static 'images/profile-icon.png' %}" alt="User 3" class="rounded-circle" style="width: 50px; height: 50px;">
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0">User 3</h6>
                            <p class="text-muted small mb-0">Let's meet up later.</p>
                        </div>
                        <span class="text-muted small">Yesterday</span>
                    </div>
                </a>

                <!-- Элемент чата -->
                <a href="" class="text-decoration-none text-dark">
                    <div class="d-flex align-items-center p-3 border-bottom hover-bg-light">
                        <div class="position-relative me-3">
                            <img src="{% static 'images/profile-icon.png' %}" alt="User 4" class="rounded-circle" style="width: 50px; height: 50px;">
                            <div class="online-dot"></div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0">User 4</h6>
                            <p class="text-muted small mb-0">See you soon!</p>
                        </div>
                        <span class="text-muted small">10:06 AM</span>
                    </div>
                </a>
            </div>
        </div>

        <!-- Окно чата -->
        <div class="col-md-9 chat-window p-3 d-flex flex-column" style="min-width: 0;">
            <!-- Шапка чата -->
            <div class="chat-header d-flex align-items-center mb-3">
                <div>
                    <h5 class="mb-0">public_chat</h5>
                    <div class="flex justify-center text-emerald-400 bg-gray-800 p-2 sticky top-0 z-10">
                        <span id="online-count" class="pr-1"></span> online
                    </div>
                </div>
            </div>

            <!-- Контейнер сообщений -->
            <div id='chat_container' class="chat-messages flex-grow-1 d-flex flex-column" style="overflow-y: auto;">
                <ul id="chat_messages" class="list-unstyled d-flex flex-column justify-content-end">
                    {% for message in chat_messages reversed %}
                        {% include "chat/chat_message.html" %}
                    {% endfor %}
                </ul>
            </div>

            <!-- Поле ввода сообщения -->
            <div class="chat-input p-2">
                <form id="chat_message_form" 
                    class="d-flex align-items-center gap-2 rounded p-2"
                    hx-ext="ws"
                    ws-connect="/ws/chat/public_chat"
                    ws-send
                    _="on htmx:wsAfterSend reset() me">

                    {% csrf_token %}

                    <i class="fas fa-paperclip text-muted fs-4"></i>
                    <input type="text" class="form-control flex-grow-1" placeholder="Type a message..." name="context" id="id_context" required>
                    <i class="far fa-smile text-muted fs-4"></i>
                    <button class="btn btn-primary d-flex align-items-center justify-content-center">
                        <i class="fas fa-paper-plane fs-5"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}